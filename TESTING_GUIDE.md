# MCP Platform - 测试指南

## 🧪 系统测试手册

### 测试前准备

#### 1. 环境检查

**Python环境**
```bash
python --version  # 应该 >= 3.9
```

**Node.js环境**
```bash
node --version    # 应该 >= 16
npm --version     # 应该 >= 8
```

#### 2. 依赖安装

**后端依赖**
```bash
cd backend
pip install -r requirements.txt

# 下载spaCy模型（可选）
python -m spacy download zh_core_web_sm
```

**前端依赖**
```bash
cd frontend
npm install
```

#### 3. 配置检查

**后端配置 (backend/.env)**
```bash
# 检查文件是否存在
cat backend/.env

# 如果不存在，从示例复制
cp backend/.env.example backend/.env
```

必须配置项：
- `OPENAI_API_KEY` - 用于RAG问答（可选）
- `NEO4J_URI` - Neo4j地址（可选）
- `NEO4J_PASSWORD` - Neo4j密码（可选）

**前端配置 (frontend/.env.local)**
```bash
# 应该包含
VITE_API_URL=http://localhost:8000
```

---

## 🚀 启动测试

### 步骤1: 启动后端服务

```bash
cd backend
python -m uvicorn app.main:app --reload --port 8000
```

**预期输出**:
```
INFO:     Uvicorn running on http://0.0.0.0:8000
INFO:     Application startup complete.
============================================================
MCP Platform Initialized
  - Knowledge Graph (Neo4j): ✓ / ✗
  - Vector Store (ChromaDB): ✓
  - RAG Engine (OpenAI): ✓ / ✗
============================================================
```

**验证**:
- 访问 http://localhost:8000
- 应该看到 JSON 响应
- 访问 http://localhost:8000/docs
- 应该看到 Swagger API 文档

### 步骤2: 启动前端服务

```bash
cd frontend
npm run dev
```

**预期输出**:
```
  VITE v5.0.7  ready in XXX ms

  ➜  Local:   http://localhost:3000/
  ➜  Network: http://192.168.x.x:3000/
```

**验证**:
- 访问 http://localhost:3000
- 应该看到 MCP Platform 首页
- 右上角应该显示系统状态

### 步骤3: 启动Neo4j（可选）

**使用Docker**:
```bash
docker run -d \
  --name neo4j \
  -p 7474:7474 -p 7687:7687 \
  -e NEO4J_AUTH=neo4j/password \
  neo4j:latest
```

**验证**:
- 访问 http://localhost:7474
- 使用 neo4j/password 登录

---

## ✅ 功能测试清单

### 测试1: 系统状态检查 ⬜

**位置**: 首页

**步骤**:
1. 打开 http://localhost:3000
2. 查看右上角状态指示器

**预期结果**:
- ✅ 知识图谱: 绿色（如果Neo4j启动）/ 红色（未启动）
- ✅ 向量检索: 绿色（ChromaDB自动可用）
- ✅ AI问答: 绿色（如果配置OpenAI）/ 红色（未配置）

**检查点**:
- [ ] 状态指示器正确显示
- [ ] 统计数据正常加载
- [ ] 核心功能卡片展示

---

### 测试2: 文档上传 ⬜

**位置**: 文档管理页面

**步骤**:
1. 点击左侧菜单"文档管理"
2. 准备一个PDF或DOCX文件
3. 拖拽文件到上传区域
4. 观察上传进度

**预期结果**:
- ✅ 进度条显示上传百分比
- ✅ 上传成功后显示成功消息
- ✅ 显示提取的实体数量和文本块数
- ✅ 文档出现在列表中

**检查点**:
- [ ] 文件上传成功
- [ ] 进度条正常工作
- [ ] 成功消息显示
- [ ] 文档列表更新

**测试用例**:
```
✓ 上传 PDF 文件 (<10MB)
✓ 上传 DOCX 文件 (<10MB)
✗ 上传 TXT 文件 (应该拒绝)
✗ 上传 >10MB 文件 (应该拒绝)
```

---

### 测试3: 文档列表和详情 ⬜

**位置**: 文档管理页面

**步骤**:
1. 在文档列表中点击"查看"按钮
2. 查看文档详情弹窗

**预期结果**:
- ✅ 显示文档元数据
- ✅ 显示实体和关系数量
- ✅ 显示文件类型和大小

**检查点**:
- [ ] 详情弹窗正常打开
- [ ] 所有信息正确显示
- [ ] 关闭按钮正常工作

---

### 测试4: 知识图谱可视化 ⬜

**位置**: 知识图谱页面

**前提条件**: Neo4j已启动

**步骤**:
1. 点击左侧菜单"知识图谱"
2. 在下拉框中选择已上传的文档
3. 点击"刷新图谱"

**预期结果**:
- ✅ 显示交互式图谱
- ✅ 节点按类型着色（技术=绿色，组织=紫色等）
- ✅ 关系用箭头表示
- ✅ 可以缩放和拖拽

**交互测试**:
- [ ] 鼠标滚轮缩放
- [ ] 拖拽画布移动
- [ ] 点击节点查看详情
- [ ] 详情抽屉正常显示

**检查点**:
- [ ] 图谱加载成功
- [ ] 节点数量正确
- [ ] 关系数量正确
- [ ] 交互功能正常

---

### 测试5: 语义搜索 ⬜

**位置**: 语义搜索页面

**步骤**:
1. 点击左侧菜单"语义搜索"
2. 在搜索框输入查询词（如"机器学习"）
3. 点击"搜索"

**预期结果**:
- ✅ 显示相关文档片段
- ✅ 显示相似度评分
- ✅ 结果按相似度排序

**测试用例**:
```
查询: "深度学习"
预期: 返回包含深度学习相关的文档片段

查询: "人工智能的应用"
预期: 返回语义相关的内容（不只是关键词匹配）
```

**参数测试**:
- [ ] 切换到"纯语义搜索"模式
- [ ] 切换到"混合搜索"模式
- [ ] 调整返回数量（1-20）
- [ ] 调整语义权重（0.0-1.0）

**检查点**:
- [ ] 搜索结果正确
- [ ] 评分合理（0-1之间）
- [ ] 参数调整生效

---

### 测试6: AI问答 ⬜

**位置**: AI问答页面

**前提条件**: 已配置OpenAI API Key

**步骤**:
1. 点击左侧菜单"AI问答"
2. 输入问题（如"什么是深度学习？"）
3. 点击"发送"或按Enter

**预期结果**:
- ✅ 显示思考中状态
- ✅ 返回AI生成的答案
- ✅ 显示来源文档片段
- ✅ 显示置信度评分

**测试用例**:
```
问题1: "文档主要讲了什么？"
预期: 生成摘要性答案

问题2: "深度学习有哪些应用？"
预期: 基于文档内容回答

问题3: "xxx是什么？" （文档中不存在）
预期: 说明文档中没有相关信息
```

**交互测试**:
- [ ] 连续提问（多轮对话）
- [ ] 点击"来源"查看证据
- [ ] Shift+Enter 换行
- [ ] Markdown格式正确渲染

**检查点**:
- [ ] 答案生成成功
- [ ] 来源溯源正确
- [ ] 置信度合理
- [ ] 对话界面流畅

---

### 测试7: 文档删除 ⬜

**位置**: 文档管理页面

**步骤**:
1. 在文档列表中点击"删除"
2. 确认删除操作

**预期结果**:
- ✅ 显示确认对话框
- ✅ 删除成功后显示消息
- ✅ 文档从列表中移除
- ✅ 相关数据被清理

**检查点**:
- [ ] 确认对话框出现
- [ ] 删除成功
- [ ] 列表更新
- [ ] 向量数据被删除

---

## 🔍 错误处理测试

### 测试8: 后端服务未启动 ⬜

**步骤**:
1. 停止后端服务
2. 在前端尝试操作

**预期结果**:
- ✅ 显示"无法连接到后端服务"错误消息
- ✅ 界面不崩溃

### 测试9: Neo4j未启动 ⬜

**步骤**:
1. 停止Neo4j服务
2. 访问知识图谱页面

**预期结果**:
- ✅ 显示"知识图谱服务未启用"
- ✅ 其他功能正常

### 测试10: OpenAI API未配置 ⬜

**步骤**:
1. 不配置OPENAI_API_KEY
2. 尝试使用AI问答

**预期结果**:
- ✅ 显示"RAG问答服务未启用"
- ✅ 提示配置API密钥

---

## 📊 性能测试

### 测试11: 大文件处理 ⬜

**测试用例**:
- 5MB PDF文件
- 接近10MB的文件

**检查点**:
- [ ] 上传时间 < 30秒
- [ ] 处理时间合理
- [ ] 内存占用正常

### 测试12: 多文档处理 ⬜

**步骤**:
1. 上传5-10个文档
2. 测试搜索性能

**检查点**:
- [ ] 搜索响应 < 1秒
- [ ] 图谱加载 < 2秒

---

## 🐛 常见问题排查

### 问题1: 后端启动失败

**症状**:
```
ModuleNotFoundError: No module named 'xxx'
```

**解决**:
```bash
cd backend
pip install -r requirements.txt
```

### 问题2: 前端启动失败

**症状**:
```
Cannot find module 'xxx'
```

**解决**:
```bash
cd frontend
rm -rf node_modules
npm install
```

### 问题3: ChromaDB错误

**症状**:
```
chromadb.errors.xxx
```

**解决**:
```bash
# 删除数据重新开始
rm -rf backend/data/chroma
```

### 问题4: Neo4j连接失败

**症状**:
```
Failed to connect to Neo4j
```

**解决**:
1. 检查Neo4j是否启动
2. 检查密码是否正确
3. 检查端口7687是否开放

---

## ✅ 测试完成检查表

### 基础功能
- [ ] 系统启动成功
- [ ] 所有页面可访问
- [ ] API响应正常

### 核心功能
- [ ] 文档上传成功
- [ ] 实体识别正常
- [ ] 知识图谱显示（如有Neo4j）
- [ ] 语义搜索工作
- [ ] AI问答工作（如有OpenAI）

### 用户体验
- [ ] 加载状态显示
- [ ] 错误消息友好
- [ ] 响应式布局正常
- [ ] 交互流畅

### 错误处理
- [ ] 服务降级正常
- [ ] 错误提示清晰
- [ ] 不会崩溃

---

## 📝 测试报告模板

```markdown
# MCP Platform 测试报告

## 测试信息
- 测试日期: YYYY-MM-DD
- 测试环境: [开发/生产]
- 测试人员: XXX

## 测试结果总览
- 通过: X/15
- 失败: X/15
- 跳过: X/15

## 详细测试结果

### ✅ 通过的测试
1. 系统状态检查
2. 文档上传
...

### ❌ 失败的测试
1. XXX - 错误原因
...

### ⚠️ 需要改进
1. XXX - 改进建议
...

## 性能数据
- 文档上传平均时间: XXs
- 搜索响应时间: XXXms
- 图谱加载时间: XXXms

## 问题和建议
1. ...
2. ...
```

---

## 🎯 下一步

测试完成后，请检查:
1. 所有核心功能正常
2. 错误处理得当
3. 用户体验流畅

如有问题，请查看 [常见问题排查](#常见问题排查) 或提交Issue。
